# ุงููุฑุญูุฉ 1: ุงุจุฏุฃ ูู ุตูุฑุฉ Node.js ุงูุฑุณููุฉ ูุงููุณุชูุฑุฉ
FROM node:20-bookworm

# ุงููุฑุญูุฉ 2: ุญุฏุฏ ูุฌูุฏ ุงูุนูู
WORKDIR /app

# ุงููุฑุญูุฉ 3: ูู ุจุชุซุจูุช ุงุนุชูุงุฏูุงุช ุงููุธุงู ุงูุชู ูุญุชุงุฌูุง Playwright
RUN apt-get update && apt-get install -y \
    libgbm-dev \
    libnss3 \
    libasound2 \
    libatk-bridge2.0-0 \
    libgtk-3-0

# ุงููุฑุญูุฉ 4: ุงูุณุฎ ูููุงุช ุงูุงุนุชูุงุฏูุงุช ููุท
COPY package*.json ./

# ุงููุฑุญูุฉ 5: ูู ุจุชุซุจูุช ุฌููุน ุงูุงุนุชูุงุฏูุงุช (ุจูุง ูู ุฐูู devDependencies)
RUN npm install

# ุงููุฑุญูุฉ 6: ุงูุณุฎ ุจุงูู ููุฏ ุงููุดุฑูุน
COPY . .

# ุงููุฑุญูุฉ 7: ูู ุจุชุซุจูุช ูุชุตูุญุงุช Playwright
RUN npx playwright install --with-deps

# ๐ด [ุงูุชุบููุฑ ุงูุญุงุณู] ูู ูุนุฏ ุจุญุงุฌุฉ ุฅูู ุจูุงุก ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
# RUN npm run build  <-- ููุฏ ูููุง ุจุชุนุทูู ูุฐุง ุงูุณุทุฑ

# ุงููุฑุญูุฉ 8: ุนุฑูู ุงููููุฐ
# Railway ุณููุชุดู ุงููููุฐ ุชููุงุฆููุงุ ูููู ูู ุงูุฌูุฏ ุฅุจูุงุคู
ENV PORT 10000
EXPOSE 10000

# ุงููุฑุญูุฉ 9: ุงูุฃูุฑ ุงูููุงุฆู ูุชุดุบูู ุงูุฎุงุฏู
# next start ุณูููู ุจุชุดุบูู ุฎุงุฏู Next.js ุงูุฐู ูุฎุฏู ูุณุงุฑุงุช ุงูู API
CMD ["npm", "start"]
